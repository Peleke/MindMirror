# Story 4.2: Workout Execution Regression Tests (Foundation)

## Status
Draft

## Story
**As a** developer
**I want** automated UI tests for workout logging critical path
**so that** future UI changes don't break set logging, rest timer, or core functionality

**SCOPE NOTE:** Focus on framework setup + basic smoke tests. Full test coverage deferred to Week 2-3.

## Acceptance Criteria

1. E2E test framework setup complete (Detox OR Maestro - decision required)
2. Test suite covers critical path:
   - Load workout screen → exercises render
   - Log weight/reps → data persists after app restart
   - Complete set → rest timer modal appears
   - ~~Add note to set~~ DEFERRED (Story 2.4 deferred)
   - Navigate away mid-workout → state persists on return
3. Tests run locally (iOS simulator or Android emulator)
4. Test execution time <5 minutes (smoke tests only, not full coverage)
5. ~~CI/CD integration~~ DEFERRED to Week 2-3 (run locally for now)
6. Test data seeding: Use test Supabase accounts from Story 1.3

## Tasks / Subtasks

- [ ] Choose E2E framework (AC: 1)
  - [ ] Decision: Detox (mature) vs Maestro (simpler)
  - [ ] Consult with QA Engineer or team preference
  - [ ] **RECOMMENDATION:** Maestro for alpha speed (1hr setup vs 3-4hr Detox)

- [ ] Set up E2E framework (AC: 1)
  - [ ] Install framework: `npm install --save-dev detox` or `brew install maestro`
  - [ ] Configure for React Native: Create config file (detox.config.js or maestro.yaml)
  - [ ] Set up iOS simulator and/or Android emulator

- [ ] Create test data seeding (AC: 6)
  - [ ] Use test accounts from Story 1.3 admin UI
  - [ ] Pre-create test programs and workouts
  - [ ] Document test data setup in README

- [ ] Write smoke tests (AC: 2, 4)
  - [ ] Test 1: Load workout screen, verify exercises render
  - [ ] Test 2: Log weight/reps, verify data persists
  - [ ] Test 3: Complete set, verify rest timer appears
  - [ ] Test 4: Navigate away, return, verify state persists
  - [ ] Keep tests simple (smoke tests, not exhaustive)

- [ ] Run tests locally (AC: 3)
  - [ ] iOS: Run tests on iOS simulator
  - [ ] Android: Run tests on Android emulator (if time permits)
  - [ ] Verify tests pass consistently

- [ ] (DEFERRED) CI/CD integration (AC: 5)
  - [ ] **Skip for Week 1** - run locally only
  - [ ] Week 2-3: Add GitHub Actions workflow

## Dev Notes

### Relevant Source Tree
- **Mobile App:** `mindmirror-mobile/`
- **Test Directory:** Create `mindmirror-mobile/e2e/` for test files
- **Framework Config:** `detox.config.js` or `maestro/` directory

### Key Technical Details
- **Detox:** More mature, better debugging, steeper learning curve (~3-4 hours setup)
- **Maestro:** Simpler, YAML-based tests, faster setup (~1 hour), less flexible
- Test data: Use test Supabase accounts, pre-created programs
- Tests should be deterministic (no flaky tests)

### Implementation Notes
- **Detox setup:** https://wix.github.io/Detox/docs/introduction/getting-started
- **Maestro setup:** https://maestro.mobile.dev/getting-started/installing-maestro
- Use test user accounts from Story 1.3 (avoid production data)
- Keep test data minimal (1 program, 3 exercises, simple workout)

### E2E FRAMEWORK DECISION
**Recommendation: Maestro for Week 1 speed**
- Pros: 1-hour setup, YAML tests are readable, easy to run
- Cons: Less flexible than Detox, debugging harder
- If team has Detox experience: Use Detox
- If new to E2E: Use Maestro

### ALPHA SPEED FOCUS
- **What to cut if running over time:** Android tests (test iOS only), CI/CD integration
- **Non-negotiable:** Framework setup, basic smoke tests (load workout, log set, rest timer)

### Testing
**Test file location:** `mindmirror-mobile/e2e/` (Detox) or `mindmirror-mobile/maestro/` (Maestro)

**Test standards:**
- Tests run consistently without flakiness
- Test execution time <5 minutes
- Tests cover critical path only (defer comprehensive coverage)

**Testing frameworks:**
- Detox or Maestro (decision required)

**Specific testing requirements:**
- Test 1: Load workout screen (verify exercise list renders)
- Test 2: Log set (enter weight, reps, check completion checkbox)
- Test 3: Rest timer appears (after set completion)
- Test 4: State persistence (navigate away, return, verify data intact)

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-15 | v1.0 | Initial story creation from Epic 4 | Sarah (PO Agent) |

## Dev Agent Record

### Agent Model Used
_To be populated by dev agent_

### Debug Log References
_To be populated by dev agent_

### Completion Notes
_To be populated by dev agent_

### File List
_To be populated by dev agent_

## QA Results
_To be populated by QA agent_
