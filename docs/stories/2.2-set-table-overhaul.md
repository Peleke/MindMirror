# Story 2.2: Set Table Complete Overhaul

## Status
Draft

## Story
**As a** user
**I want** a clean set table with clear previous/target/actual columns
**so that** logging sets feels effortless and I can track progression visually

**CRITICAL PATH:** This is core functionality for alpha - must be solid

## Acceptance Criteria

1. Table columns: Set # | Previous | Target | Weight | Reps | ✓ (completion checkbox)
2. Previous column shows greyed-out data from last workout (read-only, #9E9E9E)
3. Target column shows prescribed sets/reps from program (read-only, #9E9E9E)
4. Weight/Reps columns have numeric inputs with +/- stepper buttons (44px min touch target)
5. Completion checkbox fills set row with success color (green tint #E8F5E9)
6. Auto-advance focus: Weight → Reps → Next set weight (keyboard flow)
7. Handles edge case: No previous workout exists (show "—" placeholder)
8. Compact but not cramped (12px row padding, matches Hevy's density)

## Tasks / Subtasks

- [ ] Implement table layout (AC: 1, 8)
  - [ ] Create table component with 6 columns
  - [ ] Set column widths: Set# (narrow), Previous/Target (medium), Weight/Reps (medium), Checkbox (narrow)
  - [ ] Apply 12px row padding, subtle dividers (no heavy borders)

- [ ] Add Previous workout data (AC: 2, 7)
  - [ ] **INVESTIGATION REQUIRED (Day 1):** Verify GraphQL query for historical practice_instance data
  - [ ] Fetch last workout's sets for same exercise
  - [ ] Display greyed-out (#9E9E9E) in Previous column
  - [ ] Show "—" placeholder if no previous workout exists

- [ ] Display Target sets/reps (AC: 3)
  - [ ] Read target sets/reps from program/exercise prescription
  - [ ] Display as read-only text in greyed-out style (#9E9E9E)

- [ ] Create Weight/Reps inputs with steppers (AC: 4)
  - [ ] Use numeric input components with +/- buttons
  - [ ] Ensure 44px minimum touch target size (iOS HIG compliance)
  - [ ] Validate numeric input (no negative values, reasonable ranges)

- [ ] Implement completion checkbox (AC: 5)
  - [ ] Add checkbox at end of each row
  - [ ] On check, fill row background with green tint (#E8F5E9)
  - [ ] Persist completion status to practice_instance

- [ ] Add auto-advance focus (AC: 6)
  - [ ] Implement focus management: Weight → Reps → Next set Weight
  - [ ] Use React Native TextInput onSubmitEditing for keyboard flow
  - [ ] Test on both iOS and Android

## Dev Notes

### Relevant Source Tree
- **Component:** `mindmirror-mobile/app/(app)/client/[id].tsx` (workout screen)
- **GraphQL:** practices_service schema for practice_instance queries/mutations
- **Styling:** React Native StyleSheet or styled-components

### Key Technical Details
- **CRITICAL INVESTIGATION:** Verify GraphQL query can fetch previous workout data for same exercise
  - If complex, use "—" placeholder for alpha and defer full implementation
- practice_instance schema stores set data (weight, reps, completed)
- Auto-advance focus may require manual focus refs (TextInput.focus())

### Implementation Notes
- Use FlatList or ScrollView for set rows if many sets (>10)
- Optimistic UI updates for set logging (don't wait for GraphQL mutation)
- Consider using Formik or React Hook Form for input state management
- Numeric stepper buttons: Simple +/- that increment/decrement by standard amounts (weight: 5lbs, reps: 1)

### INVESTIGATION BLOCKERS
1. **Previous workout data query** - If not readily available:
   - **Option A:** Show "—" placeholder for alpha, defer full feature
   - **Option B:** Create custom resolver in practices_service (1-2 hour task)
   - **Decision:** PM + Backend Engineer to decide by Day 1

### Testing
**Test file location:** `mindmirror-mobile/__tests__/client/set-table.test.tsx`

**Test standards:**
- Unit tests for set logging logic
- Integration test for GraphQL mutations (mock Apollo Client)
- E2E test for full set logging workflow (defer to Story 4.2)

**Testing frameworks:**
- Jest + React Native Testing Library
- Mock Apollo Client for GraphQL

**Specific testing requirements:**
- Test set table renders with correct columns
- Test Previous/Target data displays correctly
- Test Weight/Reps inputs accept numeric values
- Test completion checkbox updates row styling
- Test auto-advance focus flow (Weight → Reps → Next set)
- Test edge case: No previous workout (displays "—")

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-15 | v1.0 | Initial story creation from Epic 2 | Sarah (PO Agent) |

## Dev Agent Record

### Agent Model Used
_To be populated by dev agent_

### Debug Log References
_To be populated by dev agent_

### Completion Notes
_To be populated by dev agent_

### File List
_To be populated by dev agent_

## QA Results
_To be populated by QA agent_
