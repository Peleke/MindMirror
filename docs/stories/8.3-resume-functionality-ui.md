# Story 8.3: Resume Functionality UI

## Status
Draft

## Story
**As a** user
**I want** to see a banner reminding me to complete my profile
**so that** I can easily resume the conversation I started

## Acceptance Criteria

1. Home screen checks `onboarding_status` from user profile
2. If `status === 'incomplete'`, show banner at top: "Complete your profile to unlock personalized recommendations" + "Resume" button + dismissible "X"
3. Banner reappears on next app open until profile completed
4. Tapping "Resume" opens chat UI with conversation history pre-loaded
5. Agent welcomes user back: "Welcome back, [Name]! Let's pick up where we left off."
6. Push notification sent 24 hours after incomplete status: "Finish setting up your profile!"

## Tasks / Subtasks

- [ ] Create banner component (AC: 1, 2, 3)
  - [ ] Create `OnboardingBanner.tsx` component
  - [ ] Text: "Complete your profile to unlock personalized recommendations"
  - [ ] "Resume" button (primary style)
  - [ ] "X" dismiss button (hides banner for current session only)
  - [ ] Banner styling: Yellow/orange accent color, top of home screen

- [ ] Integrate banner in home screen (AC: 1, 2)
  - [ ] Query user profile on home screen mount
  - [ ] Check `onboardingStatus === 'incomplete'`
  - [ ] Show banner if incomplete, hide if complete or skipped
  - [ ] Persist dismiss state in AsyncStorage (session-only)

- [ ] Implement resume functionality (AC: 4, 5)
  - [ ] "Resume" button navigates to `/onboarding/chat`
  - [ ] Chat component fetches conversation history from Redis
  - [ ] Load previous messages into chat UI
  - [ ] Agent sends welcome back message automatically

- [ ] Implement push notification (AC: 6)
  - [ ] Schedule notification 24 hours after `onboarding_status` set to "incomplete"
  - [ ] Notification title: "Finish your MindMirror profile"
  - [ ] Notification body: "Complete setup to get personalized recommendations"
  - [ ] Tapping notification opens app to `/onboarding/chat`
  - [ ] Only send once (not daily spam)

- [ ] Add settings toggle
  - [ ] Settings page: "Profile setup reminders" toggle
  - [ ] If disabled, don't show banner or send notification
  - [ ] Default: enabled

## Dev Notes

### Relevant Source Tree
- **Location:** `mindmirror-mobile/components/OnboardingBanner.tsx`
- **Home Screen:** `mindmirror-mobile/app/(app)/home.tsx`
- **Notifications:** Expo Notifications API

### Key Technical Details
- Expo Notifications: `expo-notifications` package
- AsyncStorage for banner dismiss state
- GraphQL query for user profile (existing Apollo Client)
- Redis stores conversation history (from Epic 6)

### Implementation Notes
```typescript
// OnboardingBanner.tsx
import { useQuery } from '@apollo/client';
import { GET_USER_PROFILE } from '@/graphql/queries';
import AsyncStorage from '@react-native-async-storage/async-storage';

export const OnboardingBanner = () => {
  const { data } = useQuery(GET_USER_PROFILE);
  const [dismissed, setDismissed] = useState(false);

  useEffect(() => {
    const checkDismissed = async () => {
      const isDismissed = await AsyncStorage.getItem('onboarding_banner_dismissed');
      setDismissed(isDismissed === 'true');
    };
    checkDismissed();
  }, []);

  if (dismissed || data?.userProfile?.onboardingStatus !== 'incomplete') {
    return null;
  }

  const handleDismiss = async () => {
    await AsyncStorage.setItem('onboarding_banner_dismissed', 'true');
    setDismissed(true);
  };

  const handleResume = () => {
    router.push('/(onboarding)/chat');
  };

  return (
    <View style={styles.banner}>
      <Text>Complete your profile to unlock personalized recommendations</Text>
      <TouchableOpacity onPress={handleResume}>
        <Text>Resume</Text>
      </TouchableOpacity>
      <TouchableOpacity onPress={handleDismiss}>
        <Text>âœ•</Text>
      </TouchableOpacity>
    </View>
  );
};

// Notification scheduling
import * as Notifications from 'expo-notifications';

export const scheduleProfileReminderNotification = async () => {
  await Notifications.scheduleNotificationAsync({
    content: {
      title: "Finish your MindMirror profile",
      body: "Complete setup to get personalized recommendations",
      data: { route: '/(onboarding)/chat' }
    },
    trigger: {
      seconds: 86400, // 24 hours
    },
  });
};
```

### Testing
**Test file location:** `mindmirror-mobile/components/__tests__/OnboardingBanner.test.tsx`

**Test standards:**
- Component rendering tests
- Notification scheduling tests
- AsyncStorage mocking for dismiss state

**Testing frameworks:**
- Jest + React Native Testing Library
- `@testing-library/react-native` for component tests
- Mock Expo Notifications

**Specific testing requirements:**
- Test banner shows when status is "incomplete"
- Test banner hidden when status is "complete"
- Test dismiss button hides banner
- Test resume button navigates to chat
- Test notification scheduled correctly (24 hours)

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-20 | v1.0 | Initial story creation from Epic 8 | Mary (Business Analyst) |

## Dev Agent Record

### Agent Model Used
_To be populated by dev agent_

### Debug Log References
_To be populated by dev agent_

### Completion Notes
_To be populated by dev agent_

### File List
_To be populated by dev agent_

## QA Results
_To be populated by QA agent_
