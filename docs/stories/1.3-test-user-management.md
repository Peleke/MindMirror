# Story 1.3: Test User Account Management

## Status
Draft

## Story
**As a** developer
**I want** admin UI to create test Supabase accounts with pre-assigned programs
**so that** I can reproduce alpha user scenarios without manual database manipulation

## Acceptance Criteria

1. Form accepts: email, password, program_id
2. Creates Supabase user account via Admin SDK
3. Auto-generates voucher and triggers auto-enrollment flow
4. Returns login credentials for immediate testing
5. Option to bulk create 3-5 test accounts with different programs

## Tasks / Subtasks

- [ ] Create test user creation page at `/admin/test-users/create` (AC: 1)
  - [ ] Add route to Next.js app (`web/src/app/admin/test-users/create/page.tsx`)
  - [ ] Create form component with email, password, program_id fields
  - [ ] Add checkbox/toggle for bulk creation mode

- [ ] Implement Supabase user creation (AC: 2, 4)
  - [ ] Use Supabase Admin SDK (`web/lib/supabase/admin.ts`)
  - [ ] Call `createUser` with email and password
  - [ ] Display success message with login credentials

- [ ] Auto-generate voucher and enroll (AC: 3)
  - [ ] Reuse voucher creation logic from Story 1.1
  - [ ] Call `autoEnrollPractices` mutation with user ID and program ID
  - [ ] Handle enrollment confirmation

- [ ] Add bulk creation functionality (AC: 5)
  - [ ] Extend form to accept multiple email/password/program combinations
  - [ ] Use CSV upload or manual multi-row input
  - [ ] Display results table with success/failure status per user

## Dev Notes

### Relevant Source Tree
- **Location:** `web/src/app/admin/test-users/` (new directory)
- **Supabase Admin SDK:** `web/lib/supabase/admin.ts`
- **Voucher Logic:** `web/src/app/api/vouchers/` (reuse from Story 1.1)
- **GraphQL Mutation:** `autoEnrollPractices` (practices_service)

### Key Technical Details
- Supabase Admin SDK allows programmatic user creation
- Admin SDK bypasses normal signup flow (no email confirmation required)
- Voucher creation + auto-enrollment can be chained in single workflow
- Bulk creation should be transaction-safe (rollback on failure)

### Implementation Notes
- Use server actions or API route for Supabase Admin SDK calls (server-side only)
- Consider generating random passwords with option to override
- Display test credentials clearly (copy-to-clipboard functionality)
- Warn user that test accounts are for development only (not production)

### Testing
**Test file location:** `web/src/app/admin/__tests__/test-users-create.test.tsx`

**Test standards:**
- Unit tests for form validation
- Integration test for Supabase Admin SDK mocking
- E2E test for full test user creation workflow

**Testing frameworks:**
- Jest + React Testing Library
- Mock Supabase Admin SDK for unit/integration tests

**Specific testing requirements:**
- Test single user creation flow
- Test bulk creation with 3-5 users
- Test error handling (duplicate email, invalid program_id)
- Test credential display and copy functionality

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-15 | v1.0 | Initial story creation from Epic 1 | Sarah (PO Agent) |

## Dev Agent Record

### Agent Model Used
_To be populated by dev agent_

### Debug Log References
_To be populated by dev agent_

### Completion Notes
_To be populated by dev agent_

### File List
_To be populated by dev agent_

## QA Results
_To be populated by QA agent_
