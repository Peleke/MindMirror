# Story 1.1: Magic Link UI

## Status
Draft

## Story
**As a** coach/admin
**I want** a web form to generate magic links with embedded vouchers
**so that** I can onboard alpha users without writing SQL or using CLI tools

## Acceptance Criteria

1. Admin UI at `/admin/vouchers/create` accepts: email, program_id, optional expiration date
2. Form validates email format and program existence before submission
3. Success response displays copyable magic link + voucher ID
4. Error states show clear messages (invalid program, duplicate voucher, etc.)
5. UI only accessible to authenticated admin users (Supabase role check)

## Tasks / Subtasks

- [ ] Create admin page at `/admin/vouchers/create` (AC: 1, 4)
  - [ ] Add route to Next.js app (`web/src/app/admin/vouchers/create/page.tsx`)
  - [ ] Create form component with email, program_id, expiration fields
  - [ ] Implement form validation (email format, required fields)

- [ ] Integrate with voucher creation endpoint (AC: 2, 3)
  - [ ] Call existing endpoint at `web/src/app/api/vouchers`
  - [ ] Validate program existence via GraphQL query to practices_service
  - [ ] Handle success response (display magic link + voucher ID with copy button)

- [ ] Implement error handling (AC: 4)
  - [ ] Display error messages for invalid inputs
  - [ ] Handle edge cases: duplicate voucher, expired program, network errors

- [ ] Add authentication check (AC: 5)
  - [ ] Use Supabase auth to verify admin role
  - [ ] Redirect to login if unauthenticated
  - [ ] Show "Access Denied" if authenticated but not admin

## Dev Notes

### Relevant Source Tree
- **Location:** `web/src/app/admin/` (existing admin directory)
- **API Endpoint:** `web/src/app/api/vouchers/` (voucher creation logic exists)
- **Auth:** `web/lib/supabase/admin.ts` (Supabase Admin SDK)
- **GraphQL:** Apollo Client for practices_service queries

### Key Technical Details
- Existing voucher endpoint can be reused/extended
- Admin panel structure already exists at `web/src/app/admin`
- `autoEnrollPractices` mutation confirmed working (user-tested)
- Supabase authentication already integrated

### Implementation Notes
- Use Next.js 13+ app router conventions
- Leverage existing admin layout/styling
- Form should be responsive (PM will test on mobile)
- Magic link format: `https://{domain}/signup?voucher={voucher_id}`

### Testing
**Test file location:** `web/src/app/admin/__tests__/vouchers-create.test.tsx` (or similar pattern)

**Test standards:**
- Unit tests for form validation logic
- Integration test for voucher creation flow (mock API)
- E2E test for full admin workflow (defer to Epic 4 if time-constrained)

**Testing frameworks:**
- Jest + React Testing Library for component tests
- Playwright or Cypress for E2E (if implemented)

**Specific testing requirements:**
- Test email validation (valid/invalid formats)
- Test program existence check (valid/invalid program_id)
- Test error handling (duplicate voucher, network failure)
- Test authentication guard (redirect unauthenticated users)

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-15 | v1.0 | Initial story creation from Epic 1 | Sarah (PO Agent) |

## Dev Agent Record

### Agent Model Used
_To be populated by dev agent_

### Debug Log References
_To be populated by dev agent_

### Completion Notes
_To be populated by dev agent_

### File List
_To be populated by dev agent_

## QA Results
_To be populated by QA agent_
